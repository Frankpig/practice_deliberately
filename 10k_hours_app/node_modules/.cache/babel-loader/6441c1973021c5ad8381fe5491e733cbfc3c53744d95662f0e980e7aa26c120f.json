{"ast":null,"code":"var _jsxFileName = \"/Users/handsomeboy/Documents/playplay/10k_hours/10k_hours_app/src/components/SkillProgress.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useContext, useMemo } from 'react';\nimport { Chart, registerables } from 'chart.js';\nimport SkillContext from '../contexts/SkillContext';\n\n// 注册所有Chart.js组件\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nChart.register(...registerables);\nfunction SkillProgress() {\n  _s();\n  const {\n    skills\n  } = useContext(SkillContext);\n  const pieChartRef = useRef(null);\n  const barChartRef = useRef(null);\n  const pieChartInstance = useRef(null);\n  const barChartInstance = useRef(null);\n\n  // 使用useMemo缓存skills数组，避免在每次渲染时都改变\n  const memoizedSkills = useMemo(() => skills, [skills]);\n  console.log('SkillProgress component mounted');\n  console.log('Skills data:', memoizedSkills);\n  useEffect(() => {\n    // 确保有技能数据且DOM已经渲染\n    if (memoizedSkills.length === 0) {\n      console.log('No skills data available');\n      return;\n    }\n    const timer = setTimeout(() => {\n      // 准备饼图数据\n      const pieData = {\n        labels: memoizedSkills.map(skill => skill.name),\n        datasets: [{\n          data: memoizedSkills.map(skill => skill.hoursPracticed),\n          backgroundColor: ['rgba(255, 99, 132, 0.7)', 'rgba(54, 162, 235, 0.7)', 'rgba(255, 206, 86, 0.7)', 'rgba(75, 192, 192, 0.7)', 'rgba(153, 102, 255, 0.7)', 'rgba(255, 159, 64, 0.7)'],\n          borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],\n          borderWidth: 1\n        }]\n      };\n\n      // 准备柱状图数据\n      const barData = {\n        labels: memoizedSkills.map(skill => skill.name),\n        datasets: [{\n          label: '已练习进度',\n          data: memoizedSkills.map(skill => {\n            // 计算百分比并保留两位小数，避免除以零\n            if (skill.targetHours === 0) return 0;\n            return Number((skill.hoursPracticed / skill.targetHours * 100).toFixed(2));\n          }),\n          backgroundColor: 'rgba(54, 162, 235, 0.7)',\n          borderColor: 'rgba(54, 162, 235, 1)',\n          borderWidth: 1,\n          barThickness: 40\n        }]\n      };\n\n      // 创建饼图\n      if (pieChartRef.current && !pieChartInstance.current) {\n        try {\n          pieChartInstance.current = new Chart(pieChartRef.current, {\n            type: 'pie',\n            data: pieData,\n            options: {\n              responsive: true,\n              maintainAspectRatio: false,\n              plugins: {\n                legend: {\n                  position: 'right'\n                },\n                title: {\n                  display: true,\n                  text: '技能练习时间分布'\n                }\n              }\n            }\n          });\n          console.log('Pie chart created successfully');\n        } catch (error) {\n          console.error('Error creating pie chart:', error);\n        }\n      }\n\n      // 创建柱状图\n      if (barChartRef.current && !barChartInstance.current) {\n        try {\n          barChartInstance.current = new Chart(barChartRef.current, {\n            type: 'bar',\n            data: barData,\n            options: {\n              responsive: true,\n              maintainAspectRatio: false,\n              scales: {\n                y: {\n                  beginAtZero: true,\n                  title: {\n                    display: true,\n                    text: '百分比 (%)'\n                  },\n                  ticks: {\n                    callback: function (value) {\n                      return value + '%';\n                    }\n                  }\n                },\n                x: {\n                  title: {\n                    display: true,\n                    text: '技能'\n                  }\n                }\n              },\n              plugins: {\n                title: {\n                  display: true,\n                  text: '技能练习进度'\n                }\n              }\n            }\n          });\n          console.log('Bar chart created successfully');\n        } catch (error) {\n          console.error('Error creating bar chart:', error);\n        }\n      }\n    }, 500); // 增加延迟时间到500ms\n\n    // 组件卸载时销毁图表\n    return () => {\n      clearTimeout(timer);\n      if (pieChartInstance.current) {\n        pieChartInstance.current.destroy();\n        pieChartInstance.current = null;\n        console.log('Pie chart destroyed');\n      }\n      if (barChartInstance.current) {\n        barChartInstance.current.destroy();\n        barChartInstance.current = null;\n        console.log('Bar chart destroyed');\n      }\n    };\n  }, [memoizedSkills]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"skill-progress-container\",\n    style: {\n      padding: '20px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\u6280\\u80FD\\u7EC3\\u4E60\\u8FDB\\u5EA6\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }, this), memoizedSkills.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u6682\\u65E0\\u6280\\u80FD\\u6570\\u636E\\uFF0C\\u8BF7\\u5148\\u6DFB\\u52A0\\u6280\\u80FD\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        flexWrap: 'wrap',\n        gap: '20px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: '400px',\n          height: '300px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: pieChartRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: '500px',\n          height: '300px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: barChartRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 5\n  }, this);\n}\n_s(SkillProgress, \"3d53kjICG2qSnj4Zirf0Bsi1o5s=\");\n_c = SkillProgress;\nexport default SkillProgress;\nvar _c;\n$RefreshReg$(_c, \"SkillProgress\");","map":{"version":3,"names":["React","useEffect","useRef","useContext","useMemo","Chart","registerables","SkillContext","jsxDEV","_jsxDEV","register","SkillProgress","_s","skills","pieChartRef","barChartRef","pieChartInstance","barChartInstance","memoizedSkills","console","log","length","timer","setTimeout","pieData","labels","map","skill","name","datasets","data","hoursPracticed","backgroundColor","borderColor","borderWidth","barData","label","targetHours","Number","toFixed","barThickness","current","type","options","responsive","maintainAspectRatio","plugins","legend","position","title","display","text","error","scales","y","beginAtZero","ticks","callback","value","x","clearTimeout","destroy","className","style","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","flexWrap","gap","width","height","ref","_c","$RefreshReg$"],"sources":["/Users/handsomeboy/Documents/playplay/10k_hours/10k_hours_app/src/components/SkillProgress.js"],"sourcesContent":["import React, { useEffect, useRef, useContext, useMemo } from 'react';\nimport { Chart, registerables } from 'chart.js';\nimport SkillContext from '../contexts/SkillContext';\n\n// 注册所有Chart.js组件\nChart.register(...registerables);\n\nfunction SkillProgress() {\n  const { skills } = useContext(SkillContext);\n  const pieChartRef = useRef(null);\n  const barChartRef = useRef(null);\n  const pieChartInstance = useRef(null);\n  const barChartInstance = useRef(null);\n\n  // 使用useMemo缓存skills数组，避免在每次渲染时都改变\n  const memoizedSkills = useMemo(() => skills, [skills]);\n\n  console.log('SkillProgress component mounted');\n  console.log('Skills data:', memoizedSkills);\n\n  useEffect(() => {\n    // 确保有技能数据且DOM已经渲染\n    if (memoizedSkills.length === 0) {\n      console.log('No skills data available');\n      return;\n    }\n\n    const timer = setTimeout(() => {\n      // 准备饼图数据\n      const pieData = {\n        labels: memoizedSkills.map(skill => skill.name),\n        datasets: [{\n          data: memoizedSkills.map(skill => skill.hoursPracticed),\n          backgroundColor: [\n            'rgba(255, 99, 132, 0.7)',\n            'rgba(54, 162, 235, 0.7)',\n            'rgba(255, 206, 86, 0.7)',\n            'rgba(75, 192, 192, 0.7)',\n            'rgba(153, 102, 255, 0.7)',\n            'rgba(255, 159, 64, 0.7)'\n          ],\n          borderColor: [\n            'rgba(255, 99, 132, 1)',\n            'rgba(54, 162, 235, 1)',\n            'rgba(255, 206, 86, 1)',\n            'rgba(75, 192, 192, 1)',\n            'rgba(153, 102, 255, 1)',\n            'rgba(255, 159, 64, 1)'\n          ],\n          borderWidth: 1\n        }]\n      };\n\n      // 准备柱状图数据\n      const barData = {\n        labels: memoizedSkills.map(skill => skill.name),\n        datasets: [{\n          label: '已练习进度',\n          data: memoizedSkills.map(skill => {\n            // 计算百分比并保留两位小数，避免除以零\n            if (skill.targetHours === 0) return 0;\n            return Number(((skill.hoursPracticed / skill.targetHours) * 100).toFixed(2));\n          }),\n          backgroundColor: 'rgba(54, 162, 235, 0.7)',\n          borderColor: 'rgba(54, 162, 235, 1)',\n          borderWidth: 1,\n          barThickness: 40\n        }]\n      };\n\n      // 创建饼图\n      if (pieChartRef.current && !pieChartInstance.current) {\n        try {\n          pieChartInstance.current = new Chart(pieChartRef.current, {\n            type: 'pie',\n            data: pieData,\n            options: {\n              responsive: true,\n              maintainAspectRatio: false,\n              plugins: {\n                legend: {\n                  position: 'right'\n                },\n                title: {\n                  display: true,\n                  text: '技能练习时间分布'\n                }\n              }\n            }\n          });\n          console.log('Pie chart created successfully');\n        } catch (error) {\n          console.error('Error creating pie chart:', error);\n        }\n      }\n\n      // 创建柱状图\n      if (barChartRef.current && !barChartInstance.current) {\n        try {\n          barChartInstance.current = new Chart(barChartRef.current, {\n            type: 'bar',\n            data: barData,\n            options: {\n              responsive: true,\n              maintainAspectRatio: false,\n              scales: {\n                y: {\n                  beginAtZero: true,\n                  title: {\n                    display: true,\n                    text: '百分比 (%)'\n                  },\n                  ticks: {\n                    callback: function(value) {\n                      return value + '%';\n                    }\n                  }\n                },\n                x: {\n                  title: {\n                    display: true,\n                    text: '技能'\n                  }\n                }\n              },\n              plugins: {\n                title: {\n                  display: true,\n                  text: '技能练习进度'\n                }\n              }\n            }\n          });\n          console.log('Bar chart created successfully');\n        } catch (error) {\n          console.error('Error creating bar chart:', error);\n        }\n      }\n    }, 500); // 增加延迟时间到500ms\n\n    // 组件卸载时销毁图表\n    return () => {\n      clearTimeout(timer);\n      if (pieChartInstance.current) {\n        pieChartInstance.current.destroy();\n        pieChartInstance.current = null;\n        console.log('Pie chart destroyed');\n      }\n      if (barChartInstance.current) {\n        barChartInstance.current.destroy();\n        barChartInstance.current = null;\n        console.log('Bar chart destroyed');\n      }\n    };\n  }, [memoizedSkills]);\n\n  return (\n    <div className=\"skill-progress-container\" style={{ padding: '20px' }}>\n      <h2>技能练习进度</h2>\n      {memoizedSkills.length === 0 ? (\n        <p>暂无技能数据，请先添加技能</p>\n      ) : (\n        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '20px' }}>\n          <div style={{ width: '400px', height: '300px' }}>\n            <canvas ref={pieChartRef}></canvas>\n          </div>\n          <div style={{ width: '500px', height: '300px' }}>\n            <canvas ref={barChartRef}></canvas>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default SkillProgress;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}